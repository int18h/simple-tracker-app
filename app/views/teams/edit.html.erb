<%= page_header('Editing Team', "Editing team", teams_path) %>

<div class="row">
  <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
  <h5 class="page-header">Team information</h5>
    <%= render 'form' %>
  </div>
  <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
    <h5 class="page-header">Add new teammates</h5>
    <%= form_tag(add_member_team_path, class: 'form-inline', remote: true) do |f| %>
      <%= label_tag "Last Name" %>
      <%= select_tag 'user_id', {}, {id: 'add_user_id'} %>
      <%= submit_tag 'Add', class: 'btn btn-default' %>
    <% end %>
  </div>
</div>
<div class="row">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <h5 class="page-header">List of Teammates</h5>
    <div class="table-responsive">
      <table class="table table-hover" id="teammates">
        <thead>
          <tr>
            <th></th>
            <th>Full name</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
        <% @team.users.each do | member | %>
          <%= render 'member_item', member: member %>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function () {
    $('#add_user_id').selectize({
      plugins: ['remove_button'],
      delimiter: ',',
      persist: false,
      valueField: 'id',
      labelField: 'full_name',
      searchField: 'full_name',
      options: [],
      create: false,
      load: function(query, callback) {
            // if (query.length < 3) return callback();
            $.ajax({
                url: '<%= search_member_team_path %>',
                type: 'GET',
                dataType: 'json',
                data: {
                    q: query,
                },
                error: function() {
                    callback();
                },
                success: function(res) {
                    callback(res);
                }
            });
        }
    });
  });
</script>
